{% extends 'FOSUserBundle::layout.html.twig' %}
{% block title %}
    <title>Konstruye.pe | {{ negocio.nombre }}</title>
{% endblock title %}
{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/jquery.rateyo.min.css') }}">
    <link rel="stylesheet" href="{{ asset('css/masterslider.css') }}">
    <link rel="stylesheet" href="{{ asset('css/style.css') }}">
{% endblock %}

{% block fos_user_content %}
    <div class="container">
            <div class="col-md-4 logo_detail_section">
                <img width="200" src="{{ vich_uploader_asset(negocio.logo, 'logoFile','AppBundle\\Entity\\Logo') }}" alt="" />
                <div id="rateYo" data-rating="{{ moy }}"></div>
                <p><i class="fa fa-map-marker" aria-hidden="true"></i> {{ negocio.direccion }}</p>
                <p>{{ negocio.distrito }} - {{ negocio.departamento }}</p>
                <p><i class="fa fa-phone" aria-hidden="true"></i> {{ negocio.telefono }}</p>
                <p><i class="fa fa-globe" aria-hidden="true"></i> {{ negocio.web }}</p>
                <p><i class="fa fa-envelope" aria-hidden="true"></i> {{ negocio.email }}</p>
                <div class="social-icons">
                    <a href="">
                    <span class="fa-stack fa-lg">
                      <i class="fa fa-square fa-stack-2x"></i>
                      <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                    </span>
                    </a>
                    <a href="">
                    <span class="fa-stack fa-lg">
                      <i class="fa fa-square fa-stack-2x"></i>
                      <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                    </span>
                    </a>
                    <a href="">
                    <span class="fa-stack fa-lg">
                      <i class="fa fa-square fa-stack-2x"></i>
                      <i class="fa fa-instagram fa-stack-1x fa-inverse"></i>
                    </span>
                    </a>
                    <a href="">
                    <span class="fa-stack fa-lg">
                      <i class="fa fa-square fa-stack-2x"></i>
                      <i class="fa fa-google-plus fa-stack-1x fa-inverse"></i>
                    </span>
                    </a>
                </div>
                <a class="contactenos_button" href="#">
                    <button class="btn btn-default"> contáctanos </button>
                </a>
            </div>

            <div class="col-md-8">


                    <div class="master-slider ms-skin-default" id="masterslider">
                        {% if negocio.fotos|length > 0 %}
                            {% for nfo in negocio.fotos  %}
                                <div class="ms-slide">
                                    {% if nfo.videoUrl is not null %}
                                        <a href="{{ nfo.videoUrl }}" data-type="video"> vimeo video </a>
                                    {% endif %}
                                    <img src="{{ vich_uploader_asset(nfo, 'imgFile') }}" alt="" />

                                </div>
                            {% endfor %}
                        {% else %}

                            <div class="ms-slide">
                                <img src="{{ asset('images/assets/cosapi_slider1.jpg') }}" alt="">
                            </div>
                            <div class="ms-slide">
                                <img src="{{ asset('images/assets/cosapi_slider1.jpg') }}" alt="">
                            </div>
                            <div class="ms-slide">
                                <img src="{{ asset('images/assets/cosapi_slider1.jpg') }}" alt="">
                            </div>

                        {% endif %}


                    </div>


            </div>
    </div>

    <div class="container detail_description">
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusantium asperiores, aspernatur cupiditate ea eos eum incidunt ipsum iste maiores neque nobis odio quae quia repellat repudiandae soluta temporibus velit voluptatum. Lorem ipsum dolor sit amet, consectetur adipisicing elit. Culpa dignissimos distinctio dolore excepturi explicabo harum, id illum ipsum nisi provident quia quod, veritatis. Ad ea error maiores odit officiis pariatur!</p>
    </div>

    <div class="container proyects-links">

    </div>







    {% if negocio.proyectos|length>0  %}
        <div class="container proyect-slider">
            <div class="col-md-9 col-xs-12 ajax-proyecto">

            </div>
            <div class="col-md-3">
                {{ render(controller(
                'AppBundle:Proyecto:lastProyectos',
                { 'id_negocio':negocio.id,'max': 4 }
                )) }}
            </div>
        </div>
    {% else %}
        <h1 style="text-align:center;font-size: 50px;margin-bottom: 15px;color: #1C9CD9"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i></h1>
        <h2 style="text-align:center;">Este Negocio no tiene proyectos</h2>

    {% endif %}



    <div class="container-fluid googlemaps">
        <div class="row">
            {% if map is defined %}
                {{ google_map(map) }}
            {% endif %}

        </div>
    </div>







    <div class="container comments_details">
        <div class="col-md-8 col-md-offset-2">
            {% for type, messages in app.session.flashbag.all() %}
                {% for message in messages %}
                    <div class="flash-{{ type }}">
                        <i class="fa fa-check-circle" aria-hidden="true"></i> {{ message }}
                    </div>
                {% endfor %}
            {% endfor %}
            <div class="star-form">
                {% if form is defined %}
                    {{ form_start(form,{attr: {novalidate: 'novalidate'}}) }}



                    <div class="rating-container">
                        <div style="margin: 0 auto" id="rateYo2"></div>
                        <div class="counter"></div>
                    </div>


                    <div class="form-group">
                        {{ form_label(form.titulo,'Título') }}
                        {% if form.titulo.vars.errors|length>0 %}
                            <div class="alert alert-danger" role="alert">
                                <div> <i class="fa fa-exclamation-circle" aria-hidden="true"></i>{{ form_errors(form.titulo) }}</div>
                            </div>
                        {% endif %}

                        {{ form_widget(form.titulo,{ 'attr': {'class': 'form-control','placeholder':'¡Excelente!'}}) }}
                    </div>
                    <div class="form-group">
                        {{ form_label(form.comentario,'Comentario') }}
                        {% if form.comentario.vars.errors|length>0 %}
                            <div class="alert alert-danger" role="alert">
                                <div> <i class="fa fa-exclamation-circle" aria-hidden="true"></i>{{ form_errors(form.comentario) }}</div>
                            </div>
                        {% endif %}

                        {{ form_widget(form.comentario,{ 'attr': {'class': 'form-control','placeholder':'Tu comentario','rows':'6'}}) }}
                    </div>

                    <div class="form-group">
                        {{ form_widget(form.submit,{ 'attr': {'class': 'btn btn-konstruye'},'label': 'Enviar'}) }}
                    </div>


                    {{ form_end(form) }}
                {% endif %}
            </div>
            {% for c in comentarios %}
                <div class="media comment">
                    <div class="media-left">
                        <img class="img-circle" alt="user icon" src="http://placehold.it/100x100x?text=Foto+Perfil">
                    </div>
                    <div class="media-body">
                        <h3>{{ c.titulo }}</h3>
                        <div class="rateYo_comments" data-rating="{{ c.nota }}"></div><span>{{ c.user.nombres }} - </span>
                        <small class="date">{{ c.adedAt|date("d F, Y") }}</small>
                        <p>
                            {{ c.comentario }}
                        </p>
                    </div>
                </div>
            {% endfor %}
        </div>

    </div>
{% endblock fos_user_content %}


{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('js/jquery.rateyo.min.js') }}"></script>
    <script src="{{ asset('js/masterslider.min.js') }}" type="text/javascript"></script>
    <script>
        $(document).ready(function() {

            var rutaproyecto = $('.link_proyecto a').attr('data-url');


            $.ajax({
                // la URL para la petición
                url : rutaproyecto,

                // la información a enviar
                // (también es posible utilizar una cadena de datos)
                //data : { id : 123 },

                // especifica si será una petición POST o GET
                type : 'GET',

                // el tipo de información que se espera de respuesta
                //dataType : 'json',

                // código a ejecutar si la petición es satisfactoria;
                // la respuesta es pasada como argumento a la función
                success : function(result) {
                    $( ".ajax-proyecto" ).html( result );
                },

                // código a ejecutar si la petición falla;
                // son pasados como argumentos a la función
                // el objeto de la petición en crudo y código de estatus de la petición
                error : function(xhr, status) {
                    alert('Disculpe, existió un problema');
                }

                // código a ejecutar sin importar si la petición falló o no
                //complete : function(xhr, status) {
                //    alert('Petición realizada');
                //}
            });




            var slider = new MasterSlider();
            slider.control('arrows' ,{insertTo:'#masterslider'});
            slider.control('bullets');

            slider.setup('masterslider' , {
                width:750,
                height:470,
                space:0,
                grabCursor:false,
                view:'basic',
                layout:'boxed',
                speed:20
            });


            var slider2 = new MasterSlider();
            slider2.control('arrows' ,{insertTo:'#masterslider2'});
            slider2.control('bullets');

            slider2.setup('masterslider2' , {
                width:930,
                height:500,
                space:0,
                grabCursor:false,
                view:'basic',
                layout:'boxed',
                speed:20
            });


            var color ="#30BDEF";
            var test = $("#rateYo").attr("data-rating");


            $("#rateYo").rateYo({
                rating: test,
                ratedFill: color,
                normalFill: "#A0A0A0",
                readOnly: true
            });


            var recuperar = $("#comentario_negocio_nota").attr("value");

            $("#rateYo2").rateYo({
                        rating: recuperar,
                        ratedFill: "#0097C9",
                        normalFill: "#A0A0A0",
                        starWidth: "60px",
                        onChange: function (rating, rateYoInstance) {
                            $(this).next().text(rating);
                        }

                    })
                    .on("rateyo.set", function (e, data) {
                        $("#comentario_negocio_nota").val(data.rating);
                        $("#rateYo2").rateYo("option", "readOnly", true);
                        $("#rateYo2").rateYo("option", "ratedFill", "#30BDEF");
                    });


            $("#rateYo2").mouseleave(function(){
                $("#rateYo2").rateYo("option", "readOnly", false);
            });
            $("#rateYo2").mouseenter(function(){
                $("#rateYo2").rateYo("option", "ratedFill", color);
            });



            $( ".rateYo_comments" ).each(function( index ) {
                $(this).rateYo({
                    rating: $(this).attr("data-rating"),
                    starWidth: "20px",
                    readOnly: true,
                    ratedFill: color,
                    normalFill: "#A0A0A0"
                });
            });

        });
    </script>
{% endblock javascripts %}